const noiseValue=/^-?\d+n+$/,originalStringify=JSON.stringify,originalParse=JSON.parse;export const JSONStringify=(n,t,r)=>{if("rawJSON"in JSON)return originalStringify(n,((n,r)=>"bigint"==typeof r?JSON.rawJSON(r.toString()):"function"==typeof t?t(n,r):(Array.isArray(t)&&t.includes(n),r)),r);if(!n)return originalStringify(n,t,r);const e=originalStringify(n,((n,r)=>"string"==typeof r&&Boolean(r.match(noiseValue))||"bigint"==typeof r?r.toString()+"n":"function"==typeof t?t(n,r):(Array.isArray(t)&&t.includes(n),r)),r);return e.replace(/([\[:])?"(-?\d+)n"($|([\\n]|\s)*(\s|[\\n])*[,\}\]])/g,"$1$2$3").replace(/([\[:])?("-?\d+n+)n("$|"([\\n]|\s)*(\s|[\\n])*[,\}\]])/g,"$1$2$3")};const isContextSourceSupported=()=>{let n=!1;return JSON.parse('{"test": 1}',((t,r,e)=>("test"===t&&e&&"1"===e.source&&(n=!0),r))),n},JSONParseV2=(n,t)=>{const r=/^-?\d+$/;return JSON.parse(n,((n,e,i)=>{const o="number"==typeof e&&(e>Number.MAX_SAFE_INTEGER||e<Number.MIN_SAFE_INTEGER),s=r.test(i.source);return o&&s?BigInt(i.source):"function"!=typeof t?e:t(n,e,i)}))};export const JSONParse=(n,t)=>{if(!n)return originalParse(n,t);if(isContextSourceSupported())return JSONParseV2(n,t);const r=Number.MAX_SAFE_INTEGER.toString(),e=r.length,i=/^"-?\d+n+"$/,o=/^-?\d+n$/,s=n.replace(/"(?:\\.|[^"])*"|-?(0|[1-9][0-9]*)(\.[0-9]+)?([eE][+-]?[0-9]+)?/g,((n,t,o,s)=>{const a='"'===n[0];if(a&&Boolean(n.match(i)))return n.substring(0,n.length-1)+'n"';const u=o||s,g=t&&(t.length<e||t.length===e&&t<=r);return a||u||g?n:'"'+n+'n"'}));return originalParse(s,((n,r,e)=>{if("string"==typeof r&&Boolean(r.match(o)))return BigInt(r.substring(0,r.length-1));return"string"==typeof r&&Boolean(r.match(noiseValue))?r.substring(0,r.length-1):"function"!=typeof t?r:t(n,r,e)}))};